<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ê·¸ë£¹</title>
<script src = "https://code.jquery.com/jquery-3.6.1.min.js"></script>
<style type="text/css">
.group{
	display: flex;
	align-items: flex-start;
}
.GroupForm{
	margin: 20px;
}
.groupAlarm{
	margin: 20px;
}
</style>
<script type="text/javascript">

$(function(){
	$.ajax({
		type: "POST",
		url: "/group/alarmCount",
		success: function(alarmCount){
			$(".alarmCount").val(alarmCount);
		},
		error: function(){}
	})
	
	$(".GroupMemberSearch").keyup(function(event){
		if(event.key != 8){
			var memName = $(".GroupMemberSearch").val();
			
			$.ajax({
				type: "POST",
				url: "/group/GroupMemberSearch",
				data: {memName: memName},
				success: function(groupList){
					$(".NewGroupMember").html(null);
					groupList.forEach(function(group){
						const NewMemberRow = `
							<tr>
								<td onclick="MemberInsert('${group.memName}', '${group.friendNum}');" data-memNum = "${group.friendNum}">${group.memName}</td>
							</tr>`;
						$(".NewGroupMember").append(NewMemberRow);
					})
				},
				error: function(){
				}
			})
		}
	})
	
	
})

function MemberInsert(memName, memNum){
	let duplicate = false;
	
	$(".GroupMember td").each(function(){
		if($(this).data("memnum") === memNum){
			duplicate = true;
		}
	})
	
	if(!duplicate){
		const GroupMember = `
			<tr>
				<td data-memNum = "${memNum}">${memName}
				<input type = "hidden" name = "memName" value = "${memName}">
				<input type = "hidden" name = "memNum" value = "${memNum}"></td>
			</tr>
			`;
			
			$(".GroupMember").append(GroupMember);
	}else {
		alert("ì´ë¯¸ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
	}
		
}

function groupYes(groupNum){
	$.ajax({
		type: "POST",
		url: "/group/groupEnter",
		data: {groupNum:groupNum},
		success: function(){
			alert("ìˆ˜ë½ë˜ì—ˆìŠµë‹ˆë‹¤.");
			window.location.reload();
		},
		error: function(){}
	})
}

function groupNo(groupNum){
	$.ajax({
		type: "POST",
		url: "/group/groupQuit",
		data: {groupNum:groupNum},
		success: function(){
			alert("ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.");
			window.location.reload();
		},
		error: function(){}
	})
}

</script>
</head>
<body>

<h1>ê·¸ë£¹</h1>

<div class = "group">
	<table style="margin:20px;" border="1">
	   <tr>
	       <th colspan="1">ë‚´ ê·¸ë£¹</th><td>â¤ï¸ğŸ’•ğŸª¼</td>
	   </tr>
	   <th:block th:each="myGroupList:${myGroupList}">
	   
	   <tr>
	       <td>ê·¸ë£¹</td>
	       <td>[[${myGroupList.groupName}]]</td>
	   </tr>
	   <th:block th:each="groupMemberList:${groupMemberList}">
	   <tr>
	   		<td>ì°¸ì—¬ì</td>
	   		<td>[[${groupMemberList.memName}]]</td>
	   </tr>
	   </th:block>
	   </th:block>
	</table>
	    
	<div class = "GroupForm">
		<form action = "/group/GroupForm" method = "POST">
		ê·¸ë£¹ëª…: <input type = "text" name = "groupName">
		<br><br>
		<table >
			<thead>
				<tr>
					<td>ë©¤ë²„ ì¶”ê°€í•˜ê¸°: <input type = "search" class = "GroupMemberSearch"></td>
				</tr>
			</thead>
			<tbody class = "NewGroupMember">
			</tbody>
		</table>
		<br>
		<table>
			<thead>
				<tr>
					<th>ê·¸ë£¹ì›</th>
				</tr>
			</thead>
			<tbody class = "GroupMember">
			</tbody>
		</table>
		<input type = "submit" value = "ê·¸ë£¹ ë“±ë¡">
		</form>
	</div>
	
	<div class = "groupAlarm">
		<block class = "alarmBox">ì•Œë¦¼í•¨</block> <input type = "number" class = "alarmCount" value ="" readonly="readonly">
		<br><br>
		
		
		
			<th:block th:each="groupAlarmList:${groupAlarmList}">
			<table border = "1" width = "450px;">
				<th:block th:if="${groupAlarmList!=null}">
					<thead>
						<tr>
							<td colspan="3">ê·¸ë£¹ ì´ë¦„</td>
						</tr>
					</thead>
				
				</th:block>
				<tbody>
					<tr>
						<td width="300px;">
							[[${groupAlarmList.groupName}]]ì—ì„œ ì´ˆëŒ€ê°€ ì™”ìŠµë‹ˆë‹¤.
						</td>
					
						<th>
							<button type = "button"
								th:attr="onclick=|groupYes('${groupAlarmList.groupNum}');|">ìˆ˜ë½
							</button>
						</th>
						<th>
							<button type = "button"
								th:attr="onclick=|groupNo('${groupAlarmList.groupNum}');|">ê±°ì ˆ
							</button>
						</th>
					</tr>
				</tbody>
			
		</table>
		</th:block>
	</div>
</div>

</body>
</html>